<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/informationFavicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/style.css">
    <title>Edit <%= guide.title %></title>
</head>
<body>
    <%- include("partials/navbar") %>
    <div class="main-content">
        <div class="editing">
            <h1>Edit Guide</h1>
            <form action="/guide/<%= guide._id %>/edit" method="POST" id="formContainer" enctype="multipart/form-data">
                <div class="section">
                    <div>
                        <label for="title">Title</label>
                        <input type="text" name="title" id="title" value="<%= guide.title %>" required>
                    </div>
                    <div>
                        <label for="tag">Tag</label>
                        <input type="text" name="tag" id="tag" value="<%= guide.tag %>" required>
                    </div>
                    <div id="addNewSection" class="addNewSection">
                        <% guide.sections.forEach((section, index) => { %>
                            <div class="section">
                                <label for="header-<%= index %>">Header</label>
                                <input type="text" name="header[]" id="header-<%= index %>" value="<%= section.header %>" required>
                                
                                <label for="description-<%= index %>">Description</label>
                                <textarea name="description[]" id="description-<%= index %>" class="descriptionArea"><%= section.description %></textarea>
                                
                                <label for="image-<%= index %>">Image</label>
                                <input type="file" name="image[<%= index %>]" id="image-<%= index %>">
                                
                                <% if (section.image) { %>
                                    <img src="/uploads/<%= section.image %>" alt="Section Image" width="100">
                                    <input type="hidden" name="existingImage[]" value="<%= section.image %>">
                                <% } %>
                            </div>
                        <% }) %>
                    </div>
                </div>
                <button type="button" onclick="addSection()" class="newSectionButton">Add new section</button>
                <button type="submit">Update Guide</button>
            </form>
        </div>
    </div>

    <script>
        let sectionIndex = <%= guide.sections.length %>;

        function addSection() {
            let addNewSection = document.getElementById("addNewSection");

            const newSectionDiv = document.createElement('div');
            newSectionDiv.className = 'section';
            newSectionDiv.innerHTML = `
                <label for="header-${sectionIndex}">Header</label>
                <input type="text" name="header[]" id="header-${sectionIndex}" required>
                
                <label for="description-${sectionIndex}">Description</label>
                <textarea name="description[]" id="description-${sectionIndex}" class="descriptionArea"></textarea>
                
                <label for="image-${sectionIndex}">Image</label>
                <input type="file" name="image[${sectionIndex}]" id="image-${sectionIndex}">
            `;

            addNewSection.appendChild(newSectionDiv);
            sectionIndex++;
        }
    </script>
</body>
</html>